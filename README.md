# ๐ AI API Gateway Proxy

ุงู ูพุฑูฺู ฺฉ Reverse Proxy ูุฏุฑุชููุฏ ู ุณุจฺฉ ุจุฑ ูพุงู Nginx ู Docker ุงุณุช. ูุฏู ุงุตู ุงู ูพุฑูฺูุ ุฏูุฑ ุฒุฏู ูุญุฏูุฏุชโูุง ู ุชุญุฑูโูุง ุณุฑูุณโูุง ููุด ูุตููุน ู ูพูุชูุฑูโูุง ุฎุงุฑุฌ ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู ุฏุงุฎู ุงุฑุงู ุงุณุช.

## ๐ฏ ูุงุจูุชโูุง ฺฉูุฏ

- **ุฑูุน ุชุญุฑู (403 Error)**: ุฏุณุชุฑุณ ุจุฏูู ุฏุฑุฏุณุฑ ุจู OpenAIุ Gemini ู ุบุฑู
- **ูพุดุชุจุงู ุงุฒ Streaming**: ุบุฑูุนุงู ุจูุฏู Buffering ุจุฑุง ุฏุฑุงูุช ูพุงุณุฎโูุง AI ุจู ุตูุฑุช ุชุงูพ
- **ุจูููโุณุงุฒ ุดุฏู ุจุฑุง SSL**: ุชูุธูุงุช ุฎูุฏฺฉุงุฑ SNI ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุจุฑูุฒ ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู ุณุฑูุณโูุง Cloudflare
- **ุณุจฺฉ ู ุณุฑุน**: ุงุณุชูุงุฏู ุงุฒ Image ูุณุฎู Alpine ุจุฑุง ฺฉูุชุฑู ูุตุฑู ุฑู ู ูพุฑุฏุงุฒูุฏู
- **ุณุงุนุช ูุญู**: ุชูุธู ุดุฏู ุจุฑ ุฑู ุชุงูโุฒูู ุชูุฑุงู ุจุฑุง ุจุฑุฑุณ ุฏูู ูุงฺฏโูุง

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```
project-root/
โโโ nginx.conf          # ูุงู ุงุตู ุชูุธูุงุช ูพุฑูฺฉุณ
โโโ Dockerfile          # ุฏุณุชูุฑุงุช ุณุงุฎุช ฺฉุงูุชูุฑ
โโโ README.md           # ุฑุงูููุง ูพุฑูฺู
```

## ๐งฑ ูุนูุงุฑ ุณุณุชู

ุฏุฑุฎูุงุณุช ุดูุง ุงุฒ ุงุฑุงู ุจู ุณุฑูุฑ ุฎุงุฑุฌ (ูพุฑูฺฉุณ) ุงุฑุณุงู ุดุฏู ู ุงุฒ ุขูุฌุง ุจู ููุตุฏ ููุง ูุฏุงุช ูโุดูุฏ:

```
[Your App in Iran] -> [Server (Port 80)] -> [Target API (OpenAI/Telegram/etc.)]
```

## ๐ ูุณุช ุงูุฏูพููุชโูุง ูุนุงู

ุฏุฑ ุญุงู ุญุงุถุฑ ุณุฑูุณโูุง ุฒุฑ ุฏุฑ ุงู ูพุฑูฺฉุณ ูพฺฉุฑุจูุฏ ุดุฏูโุงูุฏ:

| ุณุฑูุณ | ุขุฏุฑุณ ูุญู (Proxy Path) | ุขุฏุฑุณ ููุตุฏ (Target URL) |
|-------|------------------------|------------------------|
| Telegram | `/telegram/` | `https://api.telegram.org` |
| OpenAI | `/openai/` | `https://api.openai.com` |
| Gemini | `/gemini/` | `https://generativelanguage.googleapis.com` |
| OpenRouter | `/openrouter/` | `https://openrouter.ai` |

> โ๏ธ **ูฺฉุชู ููู ุฏุฑุจุงุฑู Gemini**: ุจู ุฏูู ุณุงุณุชโูุง ูุญุฏูุฏุณุงุฒ ฺฏูฺฏูุ ููฺฉู ุงุณุช ุจุฑุฎ IPูุง ุฏุชุงุณูุชุฑ ุงูฺฉุงู ุฏุณุชุฑุณ ูุณุชูู ุจู Gemini ุฑุง ูุฏุงุดุชู ุจุงุดูุฏ. ุฏุฑ ุงู ุดุฑุงุท ุชูุตู ูโุดูุฏ ุฏุฑุฎูุงุณุชโูุง Gemini ุงุฒ ุทุฑู OpenRouter ุนุจูุฑ ุฏุงุฏู ุดููุฏ.

## ๐ ุฑุงูโุงูุฏุงุฒ ู ุงุฌุฑุง

### ูพุดโูุงุฒูุง

- ูุตุจ ุจูุฏู Docker ุจุฑ ุฑู ุณุฑูุฑ ุฎุงุฑุฌ

### ูุฑุงุญู ุงุฌุฑุง

#### ฑ. ุณุงุฎุช ุงูุฌ

ุงุจุชุฏุง ูุงูโูุง ุฑุง ุฑู ุณุฑูุฑ ฺฉูพ ฺฉุฑุฏู ู ุณูพุณ ุงูุฌ ุฑุง ุจุณุงุฒุฏ:

```bash
docker build -t my-api-proxy .
```

#### ฒ. ุงุฌุฑุง ฺฉุงูุชูุฑ

ฺฉุงูุชูุฑ ุฑุง ุงุฌุฑุง ฺฉูุฏ:

```bash
docker run -d -p 80:80 --name api-proxy --restart always my-api-proxy
```

ูพุณ ุงุฒ ุงุฌุฑุงุ ุณุฑูุณ ุงุฒ ุทุฑู ุขุฏุฑุณ ุฒุฑ ุฏุฑ ุฏุณุชุฑุณ ุฎูุงูุฏ ุจูุฏ:

```
http://your-server.com
```

## ๐งช ุชุณุช ุณุฑูุณ

ุจุฑุง ุงุทููุงู ุงุฒ ุตุญุช ุนููฺฉุฑุฏ (ูุซูุงู ุชูฺฏุฑุงู)ุ ุฏุณุชูุฑ ุฒุฑ ุฑุง ุฏุฑ ุชุฑููุงู ุจุฒูุฏ:

```bash
curl http://localhost/telegram/bot<TOKEN>/getMe
```

### ููููู ุชุณุชโูุง ุฏฺฏุฑ

#### ุชุณุช OpenAI

```bash
curl http://your-server.com/openai/v1/models \
  -H "Authorization: Bearer YOUR_OPENAI_KEY"
```

#### ุชุณุช OpenRouter

```bash
curl http://your-server.com/openrouter/api/v1/models \
  -H "Authorization: Bearer YOUR_OPENROUTER_KEY"
```

#### ุชุณุช Gemini

```bash
curl "http://your-server.com/gemini/v1/models?key=YOUR_GEMINI_KEY"
```

## โ ูุญูู ุงุถุงูู ฺฉุฑุฏู ุณุฑูุณ ุฌุฏุฏ

ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ฺฉ ุณุฑูุณ ุฌุฏุฏ (ูุซูุงู ฺฉ API ุฏฺฏุฑ)ุ ฺฉุงูุณุช ูุฑุงุญู ุฒุฑ ุฑุง ุฏุฑ ูุงู `nginx.conf` ุงูุฌุงู ุฏูุฏ:

1. ฺฉ ุจููฺฉ `location` ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ
2. ุงุฒ ุฏุณุชูุฑ `rewrite` ุจุฑุง ุญุฐู ูพุดููุฏ ูุงู ุณุฑูุณ ุงุณุชูุงุฏู ฺฉูุฏ
3. ุขุฏุฑุณ ููุตุฏ ุฑุง ุฏุฑ `proxy_pass` ูุฑุงุฑ ุฏูุฏ
4. ููุฏุงุฑ `proxy_set_header Host` ุฑุง ุจุฑุงุจุฑ ุจุง ุขุฏุฑุณ ุฏุงููู ุงุตู ููุตุฏ ูุฑุงุฑ ุฏูุฏ

### ูุซุงู: ุงุถุงูู ฺฉุฑุฏู ูพุฑูฺฉุณ GitHub

ุงฺฏุฑ ุจุฎูุงูุฏ ุงุฒ ุฏุงุฎู ุงุฑุงู ุจู APIูุง ฺฏุชโูุงุจ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏุ ุงู ฺฉุฏ ุฑุง ุจู ุงูุชูุง ุจุฎุด `server` ุฏุฑ ูุงู `nginx.conf` ุงุถุงูู ฺฉูุฏ:

```nginx
# ---------- GitHub API ----------
location /github/ {
    # ุญุฐู ฺฉููู /github/ ุงุฒ ุงุจุชุฏุง ุขุฏุฑุณ ูุจู ุงุฒ ุงุฑุณุงู ุจู ููุตุฏ
    rewrite ^/github/?(.*)$ /$1 break;
    
    # ุขุฏุฑุณ ููุตุฏ ุงุตู
    proxy_pass https://api.github.com;

    # ุณุช ฺฉุฑุฏู ูุฏุฑ Host (ุจุณุงุฑ ููู ุจุฑุง ุนุจูุฑ ุงุฒ ูุงุฑูุงู ููุตุฏ)
    proxy_set_header Host api.github.com;
    
    proxy_set_header User-Agent "curl/8.0";
    proxy_set_header Accept "*/*";
    proxy_set_header Connection "";
}
```

ุจุนุฏ ุงุฒ ุงุถุงูู ฺฉุฑุฏูุ ฺฉุงูุณุช ฺฉุงูุชูุฑ ุฑุง ูุฌุฏุฏุงู build ู ุงุฌุฑุง ฺฉูุฏ:

```bash
docker build -t my-api-proxy .
docker stop api-proxy
docker rm api-proxy
docker run -d -p 80:80 --name api-proxy --restart always my-api-proxy
```

ุญุงูุง ุจุง ูุฑุงุฎูุงู `http://SERVER_IP/github/user` ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ฺฏุชโูุงุจ ุฑุง ุฏุฑุงูุช ูโฺฉูุฏ.

## ๐ ูุฌูุฒ ุงุณุชูุงุฏู

ุงู ูพุฑูฺู ุชุญุช ูุฌูุฒ MIT ููุชุดุฑ ุดุฏู ุงุณุช.
